---
layout: default
---

<h2>Processors</h2>

<p>Cantaloupe can use different image processors for different source formats. (Assignments are made in the configuration file.) Different processors have different quality, compatibility, dependency, and performance characteristics. The ability to choose among different processors is intended to make it easy to add support for new image formats; improve support for existing image formats via the substitution of better decoders; and decouple the image server implementation from any one decoder.</p>

<p>Currently, all processors can work with <a href="resolvers.html#FilesystemResolver">FilesystemResolver</a>, and the majority can work with <a href="resolvers.html#HttpResolver">HttpResolver</a>.</p>

<p>In terms of format support, a distinction is made between the concepts of source format and output format. Available output formats may differ on a per-platform or per-instance basis depending on the source format.</p>

<p>Supported source formats depend on the processor, and possibly installed
libraries/delegates, etc., as well. Lists of these are displayed on the
landing page, at <span class="filename">/iiif</span>. A list of output formats supported <em>for a given source format</em> is contained within the response to an information request (<span class="filename">/iiif/{identifier}/info.json</span>).</p>

<p>For all of the rest of the source formats you would like to serve, it's a good idea to experiment with different processors, comparing their performance, resource usage, and output quality.</p>

<h3 id="Java2dProcessor">Java2dProcessor</h3>

<p>Java2dProcessor uses the Java ImageIO framework and Java 2D API to load and process images in a native-Java way. This is a good processor to get started with as it has no external dependencies and works out-of-the-JAR.</p>

<p>ImageIO, as its name implies, is simply an I/O interface that does not care about image formats, and therefore the list of formats supported by this processor varies depending on the codec JARs available in the classpath. Cantaloupe includes support for some common ones.</p>

<p>Java2dProcessor buffers entire source images in RAM, and is therefore
memory-intensive. (See the section on <a href="getting-started.html#Memory">memory considerations</a>.) Large amounts of RAM and fast storage help.</p>

<h3 id="GraphicsMagickProcessor">GraphicsMagickProcessor</h3>

<p>GraphicsMagickProcessor uses <a href="http://im4java.sourceforge.net">im4java</a> to fork out to the <a href="http://www.graphicsmagick.org">GraphicsMagick</a> executable
(<span class="filename">gm</span>). As such, GraphicsMagick must be installed.</p>

<p>GraphicsMagick produces high-quality output and supports all of the IIIF transforms and all IIIF output formats (assuming the necessary libraries are installed; see <a href="http://www.graphicsmagick.org/formats.html">Supported Formats</a>).</p>

<p>GraphicsMagickProcessor is a good fallback processor, as it supports a wide range of source formats and is generally faster than <a href="#ImageMagickProcessor">ImageMagickProcessor</a>. It is recommended to find or compile a "Q8" version of GraphicsMagick, as its memory use will be halved.</p>

<h3 id="ImageMagickProcessor">ImageMagickProcessor</h3>

<p>ImageMagickProcessor, like <a href="#GraphicsMagickProcessor">GraphicsMagickProcessor</a>, uses
<a href="http://im4java.sourceforge.net">im4java</a> to wrap <a href="http://www.imagemagick.org/">ImageMagick</a> commands. As such, ImageMagick must be installed.</p>

<p>ImageMagick produces high-quality output and supports all of the IIIF
transforms and all IIIF output formats, assuming the necessary delegates are installed. It also supports a wide array of source formats.</p>

<p>ImageMagick is not known for being particularly fast or efficient, but it is generally quite usable. It is recommended to find or compile a "Q8" version of ImageMagick, as its memory use will be halved.</p>

<h3 id="KakaduProcessor">KakaduProcessor</h3>

<p>KakaduProcessor uses the <span class="filename">kdu_expand</span> and <span class="filename">kdu_jp2info</span> binaries &mdash; part of the
<a href="http://www.kakadusoftware.com">Kakadu</a> SDK &mdash; to efficiently extract regions of JPEG2000 source images. This processor is capable of performing well even with large JP2s.</p>

<p>Although it does support some other operations, <span class="filename">kdu_expand</span> is mainly a decompression tool, and Cantaloupe uses only its cropping and level-reduction features. The rest of the IIIF operations (differential scaling, rotation, etc.) are performed using either the Java 2D or JAI APIs (configurable).</p>

<p>Kakadu is not free and the SDK is not included with Cantaloupe.</p>

<div class="alert alert-info">Note: KakaduProcessor does not work in Windows, as it requires access to <span class="filename">/dev/stdout</span>.</div>

<div class="alert alert-info">Note: KakaduProcessor only works with <a href="resolvers.html#FilesystemResolver">FilesystemResolver</a>.</div>

<h3 id="JaiProcessor">JaiProcessor</h3>

<p>Java Advanced Imaging (JAI) is a sophisticated image processing library developed by Sun until around 2006. JaiProcessor uses an updated fork called <a href="https://github.com/geosolutions-it/jai-ext">JAI-EXT</a>.</p>

<p>JAI offers several theoretical advantages over Java 2D for this application: a more efficient rendering pipeline that should reduce memory usage, and capability of region-of-interest decoding with some formats. Whether these advantages play out in reality is an open question; the author's own profiling seems to indicate maybe not.</p>

<p>JaiProcessor can read and write the same formats as Java2dProcessor.</p>

<p>Years ago, Sun published <a href="http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-java-client-419417.html">platform-native accelerator JARs</a> called <a href="http://www.oracle.com/technetwork/java/install-1-1-2-135866.html">mediaLib</a> for Windows, Linux, and Solaris, which improved JAI's performance. It is unknown whether these still work on modern platforms, but perhaps they are something to try.</p>

<div class="alert alert-info">Note: if mediaLib is not installed, an error message will be generated saying, "Could not find mediaLib accelerator wrapper classes. Continuing in pure Java mode." This is harmless, but can be suppressed anyway by launching Cantaloupe with the <code>-Dcom.sun.media.jai.disableMediaLib=true</code> option.</div>

<h3 id="FfmpegProcessor">FfmpegProcessor</h3>

<p>FfmpegProcessor uses the <a href="http://www.ffmpeg.org">FFmpeg</a> tool to extract still frames from video files. It can be used for video thumbnail generation รก la YouTube, as well as deep zooming of high-resolution still frames.</p>

<p>FfmpegProcessor has been tested with FFmpeg version 2.8. Other versions may or may not work.</p>

<h4>Optional Parameters</h4>

<p>FFmpegProcessor supports a <code>time</code> URL query parameter which can be used to return a frame at a particular second in the source video. The value of this parameter should be in <code>hours:minutes:seconds</code> format, like:</p>

<pre>http://example.org/iiif/video.mp4/full/full/0/default.jpg?time=00:02:15</pre>

<p>If the <code>time</code> parameter is not present in the URL, the first frame will be returned.</p>

<div class="alert alert-info">Note: the <code>time</code> parameter is nonstandard and Cantaloupe-specific.</div>

<h3 id="Compatibility">Processor/Resolver Compatibility</h3>

<p>A processor's ability to work with a given resolver depends on the interfaces implemented by both:</p>

<ul>
  <li>StreamProcessors can work with either FileResolvers or StreamResolvers.</li> <li>FileProcessors can work only with FileResolvers.</li>
</ul>

<p>In the table below, the red cells indicate processors that want to open and seek around the source data directly, and are not able to consume input from a Java stream.</p>

<table class="table table-striped table-bordered">
  <tr>
    <th rowspan="2"></th>
    <th colspan="4">Resolver</th>
  </tr>
  <tr>
    <th><a href="resolvers.html#AmazonS3Resolver">Amazon S3</a></th>
    <th><a href="resolvers.html#FilesystemResolver">Filesystem</a></th>
    <th><a href="resolvers.html#HttpResolver">HTTP</a></th>
    <th><a href="resolvers.html#JdbcResolver">JDBC</a></th>
  </tr>
  <tr>
    <td><a href="processors.html#FfmpegProcessor">FfmpegProcessor</a></td>
    <td class="bg-danger">&times;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-danger">&times;</td>
    <td class="bg-danger">&times;</td>
  </tr>
  <tr>
    <td><a href="processors.html#GraphicsMagickProcessor">GraphicsMagickProcessor</a></td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
  </tr>
  <tr>
    <td><a href="processors.html#ImageMagickProcessor">ImageMagickProcessor</a></td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
  </tr>
  <tr>
    <td><a href="processors.html#JaiProcessor">JaiProcessor</a></td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
  </tr>
  <tr>
    <td><a href="processors.html#Java2dProcessor">Java2dProcessor</a></td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-success">&check;</td>
  </tr>
  <tr>
    <td><a href="processors.html#KakaduProcessor">KakaduProcessor</a></td>
    <td class="bg-danger">&times;</td>
    <td class="bg-success">&check;</td>
    <td class="bg-danger">&times;</td>
    <td class="bg-danger">&times;</td>
  </tr>
</table>
